1
00:00:00,000 --> 00:00:03,000
我们回来了。还是Rotten Potatoes，但是这次

2
00:00:03,003 --> 00:00:06,003
我们要做一些事情。我们要使用TMDb

3
00:00:06,006 --> 00:00:11,006
添加这个新特性，制作路由，

4
00:00:11,011 --> 00:00:29,011
以及所有你要做的小规模内容。我们回到这里。

5
00:00:29,029 --> 00:00:34,029
因为这是一个新特性，我们要在特性目录下

6
00:00:34,034 --> 00:00:37,034
它自己的文件中创建。我们来看看它是什么样的。

7
00:00:37,037 --> 00:00:41,037
我把它在屏幕上显示出来。它在这里，

8
00:00:41,041 --> 00:00:45,041
这个特性，还有我作为电影迷额外给它添加的格式，

9
00:00:45,045 --> 00:00:49,045
这就是做悲观路径我们所必须完成的所有设置。

10
00:00:49,049 --> 00:00:52,049
然后到最后，我们说，我们应该看到“电影在这里不存在”。

11
00:00:52,052 --> 00:00:59,052
这就是特性。我们去Cucumber。我再清除一次。

12
00:00:59,059 --> 00:01:04,059
。我们想使用Cucumber，

13
00:01:04,064 --> 00:01:12,064
不是为了添加电影特性，而是为了搜索TMDb。我们来试试。

14
00:01:12,072 --> 00:01:15,072
这个不应该正常工作，但让我们来看看这个特性里，搜索TMDb能走到哪一步。

15
00:01:15,075 --> 00:01:23,075
这里写着“场景失败”。这个案例里一共有6个步骤，

16
00:01:23,083 --> 00:01:31,083
1个通过，1个失败，其余的被跳过。

17
00:01:31,091 --> 00:01:34,091
我在Rotten Potatoes主页，这条测试是可以通过的，

18
00:01:34,094 --> 00:01:41,094
然后我应该看到搜索TMDb后，它显示，“失败”。

19
00:01:41,101 --> 00:01:46,101
我们之前说过缺失了什么…我们之前说过缺失了什么；

20
00:01:46,106 --> 00:01:59,106
我们想添加这个Haml代码来创建视图。

21
00:01:59,119 --> 00:02:01,119
我们没有视图，所以我们来创建视图。

22
00:02:01,121 --> 00:02:09,121
我们复制它。我们要复制这段代码。那里的逻辑片段。

23
00:02:09,129 --> 00:02:18,129
我一直忘记这样做。我们已经复制好，

24
00:02:18,138 --> 00:02:22,138
现在让我们回到终端窗口，它写着，

25
00:02:22,142 --> 00:02:31,142
“将这个Haml文件加在视图下。”在视图下使用Haml文件，

26
00:02:31,151 --> 00:02:34,151
实际上是说将它添加到这个的末尾，

27
00:02:34,154 --> 00:02:41,154
所以我们将它添加到它的末尾，然后写出来。

28
00:02:41,161 --> 00:02:58,161
现在，回去。再试试Cuke。我们来再试一次。我试着把音乐《危险》放进去，

29
00:02:58,178 --> 00:03:09,178
但恐怕我们会被起诉。出了什么事？很多消息。

30
00:03:09,189 --> 00:03:14,189
它一定做了什么坏事。说话者2:

31
00:03:14,194 --> 00:03:22,194
你可能在Haml犯了缩进语法错误。

32
00:03:22,202 --> 00:03:26,202
没有，我没有。它看起来很糟，但还不是灾难到无药可救。

33
00:03:26,206 --> 00:03:29,206
没有路由，所以我只是添加了路由。

34
00:03:29,209 --> 00:03:32,209
对于路由，这个错误信息有点太多了。说话者2:之前就这样通过了。

35
00:03:32,212 --> 00:03:36,212
什么？说话者2:通过了。

36
00:03:36,216 --> 00:03:42,216
我来给你展示一下添加路由时发生的情况。

37
00:03:42,222 --> 00:03:46,222
是的，它在我添加路由以前就通过了。

38
00:03:46,226 --> 00:04:00,226
这是我必须添加的路由。我把它复制下来。复制。来到这里，

39
00:04:00,000 --> 00:04:05,240
我们需要添加路由。实际上它这里写着

40
00:04:05,245 --> 00:04:08,245
把它放在资源电影后面，代码中的评论。

41
00:04:08,248 --> 00:04:16,248
它说放在那里。现在，我已经添加了路由，

42
00:04:16,256 --> 00:04:30,256
我们来看看 Cuke如何处理。做现场演示

43
00:04:30,270 --> 00:04:38,270
总是令人兴奋。瞧，3个通过了。我们回去。

44
00:04:38,278 --> 00:04:43,278
鉴于我在Rotten Potatoes主页并搜索TMDb，

45
00:04:43,283 --> 00:04:46,283
当我填入搜索词，按下搜索，它显示，“搜索TMDb”。

46
00:04:46,286 --> 00:04:49,286
这个错误信息令人欣慰多了。

47
00:04:49,289 --> 00:04:54,289
我找不到动作，还有你应该调用的

48
00:04:54,294 --> 00:04:55,294
控制器方法。

49
00:04:55,295 --> 00:05:04,295
那是因为我们还未渲染。这看起来很好。我们回到Pastebin，

50
00:05:04,304 --> 00:05:08,304
发现假的控制器方法的做法经常是写入flash。

51
00:05:08,308 --> 00:05:11,308
它永远找不到一部电影。

52
00:05:11,311 --> 00:05:18,311
这是一个糟糕的搜索方法，总是失败。我们将它复制，

53
00:05:18,318 --> 00:05:21,318
回到控制器。我们将它添加进控制器。

54
00:05:21,321 --> 00:05:27,321
你可以保存下来。你可以把它添加在任何地方，所以我们就把它添加在顶部。

55
00:05:27,327 --> 00:05:33,327
我们已经看到它了，好像是的。现在，我们有视图，

56
00:05:33,333 --> 00:05:36,333
有路由，有动作。

57
00:05:36,336 --> 00:05:44,336
路由也应该做好映射。我们回到Cuke试试…好了，

58
00:05:44,344 --> 00:05:57,344
再来一次。等待中。太好了，全部通过。所有6个都通过了，

59
00:05:57,357 --> 00:06:01,357
全部是绿色。成功使用Cucumber让人在视觉上就感到很兴奋。

60
00:06:01,361 --> 00:06:05,361
当你做了，我也这样做了…

61
00:06:05,365 --> 00:06:10,365
你没听到阿曼德说。因为Haml没有加上括号。

62
00:06:10,370 --> 00:06:14,370
它是基于缩进的，

63
00:06:14,374 --> 00:06:17,374
我确实用VI进去过一次，它加入了额外的空间，

64
00:06:17,377 --> 00:06:21,377
然后整个都冲进去了。这让人很不安，但发生的时候又令人振奋。

65
00:06:21,381 --> 00:06:29,381
我们回到这里的PowerPoint。我们将如何制作乐观路径部分？

66
00:06:29,389 --> 00:06:35,389
我们会重复很多步骤，但路径是很棒的，

67
00:06:35,395 --> 00:06:36,395
它们也不能继续使用。但是有很多步骤，

68
00:06:36,396 --> 00:06:39,396
乐观路径和悲观路径之间是相同的。

69
00:06:39,399 --> 00:06:42,399
我们自己看来似乎不太DRY。所以你要怎么做？

70
00:06:42,402 --> 00:06:46,402
Cucumber中的背景是这样一种东西，

71
00:06:46,406 --> 00:06:49,406
“你最好在运行任何场景之前运行这个。”

72
00:06:49,409 --> 00:06:55,409
这是一堆公共的指令。你可以只写一次。

73
00:06:55,415 --> 00:06:58,415
如果我们看到这个，这是悲观路径，它比以前更短，

74
00:06:58,418 --> 00:07:02,418
因为我们把悲观路径的片段放在这里。但是现在，乐观路径也能用了。

75
00:07:02,422 --> 00:07:05,422
在这些场景运行之前，

76
00:07:05,425 --> 00:07:08,425
不论运行的是哪个，它都会完成所有的背景工作，

77
00:07:08,428 --> 00:07:12,428
然后你只需做零星片段。我们会在定义真正的方法之后

78
00:07:12,432 --> 00:07:16,432
编写乐观路径。总结一点，

79
00:07:16,436 --> 00:07:19,436
Cucumber是神奇的工具。我简直不敢相信。当我们谈论这个的时候，

80
00:07:19,439 --> 00:07:20,439
上周我在华盛顿大学，

81
00:07:20,440 --> 00:07:24,440
我将它视作魔术。

82
00:07:24,444 --> 00:07:27,444
我向他们展示3x5卡片，然后转变成一个验收测试。

83
00:07:27,447 --> 00:07:31,447
它将所有这些都融合起来，你知道，绿色的彩色步骤。

84
00:07:31,451 --> 00:07:35,451
就像我说的，通常，先做乐观路径，

85
00:07:35,455 --> 00:07:38,455
然后间歇性地处理BDD和TDD，如你们将会见到的。

86
00:07:38,458 --> 00:07:42,458
它让我们用背景充分完成了这些场景。
