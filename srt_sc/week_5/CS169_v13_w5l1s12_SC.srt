1
00:00:00,000 --> 00:00:10,000
阿曼德谈论过表单。我们添加一个表单来填写。

2
00:00:10,010 --> 00:00:15,010
用户界面如何？如果我们要为用户界面添加一个视图，

3
00:00:15,015 --> 00:00:17,015
就必须添加一个路由来连接它。

4
00:00:17,017 --> 00:00:22,017
通常来说，有一个乐观路径和一个悲观路径。

5
00:00:22,022 --> 00:00:26,022
我们来让它显示有效和无效，看看有什么区别。

6
00:00:26,026 --> 00:00:31,026
我们要做的是，我们的应用程序将…

7
00:00:31,031 --> 00:00:33,031
我们很难键入所有内容，所以有这么一个东西，

8
00:00:33,033 --> 00:00:38,033
称为电影数据库，简称TMDb，可能大家都知道。

9
00:00:38,038 --> 00:00:42,038
代替键入我们想要添加的新功能，

10
00:00:42,042 --> 00:00:48,042
它能直接从TMDb填入表单，因此我们将能够

11
00:00:48,048 --> 00:00:51,048
从Rotten Potatoes主页搜索TMDb。

12
00:00:51,051 --> 00:00:54,051
我们将需要一个LoFi用户界面和故事板来实现。

13
00:00:54,054 --> 00:00:57,054
我们要将我们要做的项目各部分组合在一起。

14
00:00:57,057 --> 00:01:01,057
我是这样做的。

15
00:01:01,061 --> 00:01:06,061
这是我在Rotten Potatoes主页上的LoFi用户界面，

16
00:01:06,066 --> 00:01:10,066
我们从TMDb添加了一部新电影，这是搜索按钮。

17
00:01:10,070 --> 00:01:15,070
在乐观路径中，也就是，我们找到这部电影，来到这里，

18
00:01:15,075 --> 00:01:18,075
然后填入《盗梦空间》以及你想要的所有信息。

19
00:01:18,078 --> 00:01:21,078
单击添加按钮，回到原处。在悲观路径中，也就是不匹配的情况下，

20
00:01:21,081 --> 00:01:24,081
你会得到这个信息：对不起，无法找到，

21
00:01:24,084 --> 00:01:27,084
请再试一遍，重新搜索。这就是

22
00:01:27,087 --> 00:01:31,087
我们要在用户界面做的。乐观路径和悲观路径

23
00:01:31,091 --> 00:01:36,091
让我们来检查一下使用特性上方的cucumber格式制作的特性

24
00:01:36,096 --> 00:01:39,096
是什么样子。用户可以通过搜索电影数据库TMDb

25
00:01:39,099 --> 00:01:43,099
来添加一部电影。作为一个电影迷，

26
00:01:43,103 --> 00:01:46,103
我可以添加新电影又无需沉闷的手动操作。我想通过在TMDb中查找详情

27
00:01:46,106 --> 00:01:50,106
来添加电影。我们先来写悲观路径。

28
00:01:50,110 --> 00:01:54,110
让我们试着添加一个无效电影。

29
00:01:54,114 --> 00:01:57,114
假设我在Rotten Potatoes主页，我应该看到

30
00:01:57,117 --> 00:02:01,117
“搜索TMDb电影”吗？当我填入“搜索条件”，

31
00:02:01,121 --> 00:02:04,121
我们来编造一个电影名称，《不存在的电影》，

32
00:02:04,124 --> 00:02:06,124
希望没有电影真的用这个名字。

33
00:02:06,126 --> 00:02:11,126
给电影它不是个好名字。然后我点“搜索TMDb”，

34
00:02:11,131 --> 00:02:13,131
就应该在Rotten Potatoes主页上看到

35
00:02:13,133 --> 00:02:17,133
TMDb未找到《不存在的电影》。

36
00:02:17,137 --> 00:02:22,137
这是悲观路径。现在，让我们试着找出

37
00:02:22,142 --> 00:02:27,142
我们需要添加什么才能让它有效。我们将需要一个视图。

38
00:02:27,147 --> 00:02:31,147
我们将要做的，如阿曼德之前所谈论过的，

39
00:02:31,151 --> 00:02:34,151
是做一个表单，给动作…我

40
00:02:34,154 --> 00:02:37,154
们还要命名一个方法

41
00:02:37,157 --> 00:02:40,157
去处理表单…我们将调用'search_ tmdb'[= form_tag : action => 'search_ tmdb' do]。

42
00:02:40,160 --> 00:02:44,160
这是我们即将在haml中创建表单所用的标签

43
00:02:44,164 --> 00:02:47,164
[% label{: for => 'search_ terms'}搜索条件。

44
00:02:47,167 --> 00:02:49,167
下一张幻灯片显示它在html中的效果。

45
00:02:49,169 --> 00:02:51,169
= text_ field_ tag 'search_ terms'

46
00:02:51,171 --> 00:02:53,171
= submit_ tag '搜索TMDb 这个 haml 变成了这个代码：

47
00:02:53,173 --> 00:02:55,173
<lable for='search_terms'> Search

48
00:02:55,175 --> 00:02:56,175
Terms</label> <input id="search_terms" name="search_terms" type="text" />

49
00:02:56,176 --> 00:03:00,176
这个将能够为我们实施表单。

50
00:03:00,000 --> 00:03:05,180
这是视图。现在如果你们想试一试…当我们尝试的时候，

51
00:03:05,185 --> 00:03:07,185
它会显示说缺失路径。所以我要慢慢来。

52
00:03:07,187 --> 00:03:13,187
我们必须在电影_控制器.rb中添加一个路径。

53
00:03:13,193 --> 00:03:18,193
我们能做的是，构建能够处理所有这些的方法。

54
00:03:18,198 --> 00:03:22,198
这两个…当它失败时，如果它无效，

55
00:03:22,202 --> 00:03:25,202
它会显示一条错误消息，但是它可以去TMD找到它。

56
00:03:25,205 --> 00:03:31,205
不幸的是，你真正会做的是开始使用

57
00:03:31,211 --> 00:03:34,211
测试驱动开发，这点我们还没讨论到。

58
00:03:34,214 --> 00:03:37,214
现在我们要做的只是悲观路径，通过使用一个

59
00:03:37,217 --> 00:03:41,217
一直失败的虚假方法。这个方法将永远找不到一部电影，

60
00:03:41,221 --> 00:03:45,221
但它会让悲观路径通过。

61
00:03:45,225 --> 00:03:48,225
阿曼德在他即将举办的讲座中，

62
00:03:48,228 --> 00:03:52,228
将会实施乐观路径，走出去搜索TMDb。

63
00:03:52,232 --> 00:03:55,232
问题是你要在BDD和TDD之间反复来回。

64
00:03:55,235 --> 00:03:58,235
但是由于教学的原因，我们只能一次去一个，

65
00:03:58,238 --> 00:04:05,238
所以今天我们只做BDD。这是我们需要用来实现连接的路径。

66
00:04:05,245 --> 00:04:07,245
post '/ movies/ search_ tmdb'

67
00:04:07,247 --> 00:04:11,247
我们把这个添加进路径.rb，然后这是我们的假方法，

68
00:04:11,251 --> 00:04:14,251
然后你可以看到阿曼德所谈论的，我们将使用flash。

69
00:04:14,254 --> 00:04:15,254
[ flash[ : warning] = " '{ params[: 

70
00:04:15,255 --> 00:04:17,255
search_ terms]} ' 未在TMDB中找到。

71
00:04:17,257 --> 00:04:18,257
我们将使用它作为一个警告而不是通知，

72
00:04:18,258 --> 00:04:22,258
而且它会给出错误消息，

73
00:04:22,262 --> 00:04:23,262
这就是我们要使用的方法。


